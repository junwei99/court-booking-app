import ts from 'typescript';
import { parseTSQuery } from '@pgtyped/parser';
export function parseFile(sourceFile) {
    const foundNodes = [];
    parseNode(sourceFile);
    function parseNode(node) {
        if (node.kind === ts.SyntaxKind.TaggedTemplateExpression) {
            const queryName = node.parent.getChildren()[0].getText();
            const taggedTemplateNode = node;
            const tagName = taggedTemplateNode.tag.getText();
            const queryText = taggedTemplateNode.template
                .getText()
                .replace('\n', '')
                .slice(1, -1)
                .trim();
            if (tagName === 'sql') {
                foundNodes.push({
                    queryName,
                    queryText,
                });
            }
        }
        ts.forEachChild(node, parseNode);
    }
    const queries = [];
    const events = [];
    for (const node of foundNodes) {
        const { query, events: qEvents } = parseTSQuery(node.queryText, node.queryName);
        queries.push(query);
        events.push(...qEvents);
    }
    return { queries, events };
}
export const parseCode = (fileContent, fileName = 'unnamed.ts') => {
    const sourceFile = ts.createSourceFile(fileName, fileContent, ts.ScriptTarget.ES2015, true);
    return parseFile(sourceFile);
};
//# sourceMappingURL=parseTypescript.js.map