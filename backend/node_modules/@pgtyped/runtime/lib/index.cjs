"use strict";var Qt=Object.create;var G=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var xe=Object.getPrototypeOf,re=Object.prototype.hasOwnProperty;var ie=(n,t)=>{for(var e in t)G(n,e,{get:t[e],enumerable:!0})},Tt=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of ee(t))!re.call(n,s)&&s!==e&&G(n,s,{get:()=>t[s],enumerable:!(r=te(t,s))||r.enumerable});return n};var C=(n,t,e)=>(e=n!=null?Qt(xe(n)):{},Tt(t||!n||!n.__esModule?G(e,"default",{value:n,enumerable:!0}):e,n)),ne=n=>Tt(G({},"__esModule",{value:!0}),n);var fe={};ie(fe,{ParameterTransform:()=>O,PreparedQuery:()=>ut,TaggedQuery:()=>K,processSQLQueryIR:()=>ot,processTSQueryAST:()=>ct,sql:()=>Zt});module.exports=ne(fe);var O=(s=>(s[s.Scalar=0]="Scalar",s[s.Spread=1]="Spread",s[s.Pick=2]="Pick",s[s.PickSpread=3]="PickSpread",s))(O||{});function q(n,t){if(t.length===0)return n;t.sort((s,u)=>s.a-u.a);let e=0,r="";for(let s of t){let u=n.slice(0,s.a+e),m=n.slice(s.b+e+1,n.length);r=u+s.sub+m,e+=r.length-n.length,n=r}return r}var Z=require("antlr4ts"),bt=require("antlr4ts/tree/ParseTreeWalker.js");var yt=require("antlr4ts/atn/ATNDeserializer.js"),Mt=require("antlr4ts/Lexer.js"),gt=require("antlr4ts/atn/LexerATNSimulator.js"),It=require("antlr4ts/VocabularyImpl.js"),Nt=C(require("antlr4ts/misc/Utils.js"),1),l=class extends Mt.Lexer{get vocabulary(){return l.VOCABULARY}constructor(t){super(t),this._interp=new gt.LexerATNSimulator(l._ATN,this)}get grammarFileName(){return"QueryLexer.g4"}get ruleNames(){return l.ruleNames}get serializedATN(){return l._serializedATN}get channelNames(){return l.channelNames}get modeNames(){return l.modeNames}static get _ATN(){return l.__ATN||(l.__ATN=new yt.ATNDeserializer().deserialize(Nt.toCharArray(l._serializedATN))),l.__ATN}};l.ID=1;l.SINGULAR_PARAM_MARK=2;l.PLURAL_PARAM_MARK=3;l.COMMA=4;l.OB=5;l.CB=6;l.WORD=7;l.REQUIRED_MARK=8;l.SPECIAL=9;l.EOF_STATEMENT=10;l.WSL=11;l.STRING=12;l.channelNames=["DEFAULT_TOKEN_CHANNEL","HIDDEN"];l.modeNames=["DEFAULT_MODE"];l.ruleNames=["QUOT","ID","SID","SINGULAR_PARAM_MARK","PLURAL_PARAM_MARK","COMMA","OB","CB","WORD","REQUIRED_MARK","SPECIAL","EOF_STATEMENT","WSL","STRING"];l._LITERAL_NAMES=[void 0,void 0,"'$'","'$$'","','","'('","')'",void 0,"'!'",void 0,"';'"];l._SYMBOLIC_NAMES=[void 0,"ID","SINGULAR_PARAM_MARK","PLURAL_PARAM_MARK","COMMA","OB","CB","WORD","REQUIRED_MARK","SPECIAL","EOF_STATEMENT","WSL","STRING"];l.VOCABULARY=new It.VocabularyImpl(l._LITERAL_NAMES,l._SYMBOLIC_NAMES,[]);l._serializedATN=`\uC91D\uCABA\u058D\uAFBA\u4F53\u0607\uEA8B\uC241X\b					\x07	\x07\b	\b			
	
\v	\v\f	\f\r	\r		\x07$
\f'\v\x07\x07\b\b		

9

\r

:\v\v\f\f@
\f\r\f\fA\r\rG
\rH\x07P
\fS\vW
Q\x07	\v\r\x07\b	
\v\f\x1B\r\x07C\\aac|2;C\\aac|\f$%'(,-/1<<>B]]_\`bb}\x80\v\f""^^[\x07	\v\r\x1B!\x07(	,\v.\r1358<?C\x1BFL \x07) !%	"$	#"$'%#%&&'%())**+\b+\b,-\x07&-
./\x07&/0\x07&0\f12\x07.234\x07*456\x07+679	879::8:;;<=\x07#=>@	?>@AA?ABBCD\x07=DEG	FEGHHFHIIJJK\bKLVMWNP\vONPSQRQORTSQTU
UWVMVQW	%:AHQV	\b`;var W=require("antlr4ts/atn/ATN.js"),Ct=require("antlr4ts/atn/ATNDeserializer.js"),Ot=require("antlr4ts/FailedPredicateException.js"),St=require("antlr4ts/NoViableAltException.js"),Pt=require("antlr4ts/Parser.js"),_=require("antlr4ts/ParserRuleContext.js"),kt=require("antlr4ts/atn/ParserATNSimulator.js"),E=require("antlr4ts/RecognitionException.js"),Dt=require("antlr4ts/Token.js"),vt=require("antlr4ts/VocabularyImpl.js"),Ut=C(require("antlr4ts/misc/Utils.js"),1),i=class extends Pt.Parser{get vocabulary(){return i.VOCABULARY}get grammarFileName(){return"QueryParser.g4"}get ruleNames(){return i.ruleNames}get serializedATN(){return i._serializedATN}createFailedPredicateException(t,e){return new Ot.FailedPredicateException(this,t,e)}constructor(t){super(t),this._interp=new kt.ParserATNSimulator(i._ATN,this)}input(){let t=new lt(this._ctx,this.state);this.enterRule(t,0,i.RULE_input);let e;try{this.enterOuterAlt(t,1),this.state=22,this.query(),this.state=24,this._errHandler.sync(this),e=this._input.LA(1),e===i.EOF_STATEMENT&&(this.state=23,this.match(i.EOF_STATEMENT)),this.state=26,this.match(i.EOF)}catch(r){if(r instanceof E.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}query(){let t=new $(this._ctx,this.state);this.enterRule(t,2,i.RULE_query);let e;try{this.enterOuterAlt(t,1);{this.state=29,this._errHandler.sync(this),e=this._input.LA(1);do this.state=28,this.ignored(),this.state=31,this._errHandler.sync(this),e=this._input.LA(1);while(!(e&-32)&&1<<e&(1<<i.ID|1<<i.COMMA|1<<i.OB|1<<i.CB|1<<i.WORD|1<<i.REQUIRED_MARK|1<<i.SPECIAL|1<<i.STRING));for(this.state=42,this._errHandler.sync(this),e=this._input.LA(1);e===i.SINGULAR_PARAM_MARK||e===i.PLURAL_PARAM_MARK;){for(this.state=33,this.param(),this.state=37,this._errHandler.sync(this),e=this._input.LA(1);!(e&-32)&&1<<e&(1<<i.ID|1<<i.COMMA|1<<i.OB|1<<i.CB|1<<i.WORD|1<<i.REQUIRED_MARK|1<<i.SPECIAL|1<<i.STRING);)this.state=34,this.ignored(),this.state=39,this._errHandler.sync(this),e=this._input.LA(1);this.state=44,this._errHandler.sync(this),e=this._input.LA(1)}}}catch(r){if(r instanceof E.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}param(){let t=new S(this._ctx,this.state);this.enterRule(t,4,i.RULE_param);try{switch(this.state=49,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,4,this._ctx)){case 1:this.enterOuterAlt(t,1),this.state=45,this.pickParam();break;case 2:this.enterOuterAlt(t,2),this.state=46,this.arrayPickParam();break;case 3:this.enterOuterAlt(t,3),this.state=47,this.scalarParam();break;case 4:this.enterOuterAlt(t,4),this.state=48,this.arrayParam();break}}catch(e){if(e instanceof E.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}ignored(){let t=new P(this._ctx,this.state);this.enterRule(t,6,i.RULE_ignored);let e;try{let r;this.enterOuterAlt(t,1);{this.state=52,this._errHandler.sync(this),r=1;do{switch(r){case 1:this.state=51,e=this._input.LA(1),!(e&-32)&&1<<e&(1<<i.ID|1<<i.COMMA|1<<i.OB|1<<i.CB|1<<i.WORD|1<<i.REQUIRED_MARK|1<<i.SPECIAL|1<<i.STRING)?(this._input.LA(1)===Dt.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this);break;default:throw new St.NoViableAltException(this)}this.state=54,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,5,this._ctx)}while(r!==2&&r!==W.ATN.INVALID_ALT_NUMBER)}}catch(r){if(r instanceof E.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}scalarParam(){let t=new Y(this._ctx,this.state);this.enterRule(t,8,i.RULE_scalarParam);try{this.enterOuterAlt(t,1),this.state=56,this.match(i.SINGULAR_PARAM_MARK),this.state=57,this.scalarParamName()}catch(e){if(e instanceof E.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}pickParam(){let t=new V(this._ctx,this.state);this.enterRule(t,10,i.RULE_pickParam);let e;try{let r;this.enterOuterAlt(t,1);{for(this.state=59,this.match(i.SINGULAR_PARAM_MARK),this.state=60,this.paramName(),this.state=61,this.match(i.OB),this.state=62,this.pickKey(),this.state=67,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,6,this._ctx);r!==2&&r!==W.ATN.INVALID_ALT_NUMBER;)r===1&&(this.state=63,this.match(i.COMMA),this.state=64,this.pickKey()),this.state=69,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,6,this._ctx);this.state=71,this._errHandler.sync(this),e=this._input.LA(1),e===i.COMMA&&(this.state=70,this.match(i.COMMA)),this.state=73,this.match(i.CB)}}catch(r){if(r instanceof E.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}arrayPickParam(){let t=new j(this._ctx,this.state);this.enterRule(t,12,i.RULE_arrayPickParam);let e;try{let r;this.enterOuterAlt(t,1);{for(this.state=75,this.match(i.PLURAL_PARAM_MARK),this.state=76,this.paramName(),this.state=77,this.match(i.OB),this.state=78,this.pickKey(),this.state=83,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,8,this._ctx);r!==2&&r!==W.ATN.INVALID_ALT_NUMBER;)r===1&&(this.state=79,this.match(i.COMMA),this.state=80,this.pickKey()),this.state=85,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,8,this._ctx);this.state=87,this._errHandler.sync(this),e=this._input.LA(1),e===i.COMMA&&(this.state=86,this.match(i.COMMA)),this.state=89,this.match(i.CB)}}catch(r){if(r instanceof E.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}arrayParam(){let t=new z(this._ctx,this.state);this.enterRule(t,14,i.RULE_arrayParam);try{this.enterOuterAlt(t,1),this.state=91,this.match(i.PLURAL_PARAM_MARK),this.state=92,this.scalarParamName()}catch(e){if(e instanceof E.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}scalarParamName(){let t=new k(this._ctx,this.state);this.enterRule(t,16,i.RULE_scalarParamName);try{switch(this.enterOuterAlt(t,1),this.state=94,this.match(i.ID),this.state=96,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,10,this._ctx)){case 1:this.state=95,this.match(i.REQUIRED_MARK);break}}catch(e){if(e instanceof E.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}paramName(){let t=new D(this._ctx,this.state);this.enterRule(t,18,i.RULE_paramName);try{this.enterOuterAlt(t,1),this.state=98,this.match(i.ID)}catch(e){if(e instanceof E.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}pickKey(){let t=new g(this._ctx,this.state);this.enterRule(t,20,i.RULE_pickKey);let e;try{this.enterOuterAlt(t,1),this.state=100,this.match(i.ID),this.state=102,this._errHandler.sync(this),e=this._input.LA(1),e===i.REQUIRED_MARK&&(this.state=101,this.match(i.REQUIRED_MARK))}catch(r){if(r instanceof E.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}static get _ATN(){return i.__ATN||(i.__ATN=new Ct.ATNDeserializer().deserialize(Ut.toCharArray(i._serializedATN))),i.__ATN}};i.ID=1;i.SINGULAR_PARAM_MARK=2;i.PLURAL_PARAM_MARK=3;i.COMMA=4;i.OB=5;i.CB=6;i.WORD=7;i.REQUIRED_MARK=8;i.SPECIAL=9;i.EOF_STATEMENT=10;i.WSL=11;i.STRING=12;i.RULE_input=0;i.RULE_query=1;i.RULE_param=2;i.RULE_ignored=3;i.RULE_scalarParam=4;i.RULE_pickParam=5;i.RULE_arrayPickParam=6;i.RULE_arrayParam=7;i.RULE_scalarParamName=8;i.RULE_paramName=9;i.RULE_pickKey=10;i.ruleNames=["input","query","param","ignored","scalarParam","pickParam","arrayPickParam","arrayParam","scalarParamName","paramName","pickKey"];i._LITERAL_NAMES=[void 0,void 0,"'$'","'$$'","','","'('","')'",void 0,"'!'",void 0,"';'"];i._SYMBOLIC_NAMES=[void 0,"ID","SINGULAR_PARAM_MARK","PLURAL_PARAM_MARK","COMMA","OB","CB","WORD","REQUIRED_MARK","SPECIAL","EOF_STATEMENT","WSL","STRING"];i.VOCABULARY=new vt.VocabularyImpl(i._LITERAL_NAMES,i._SYMBOLIC_NAMES,[]);i._serializedATN=`\uC91D\uCABA\u058D\uAFBA\u4F53\u0607\uEA8B\uC241k					\x07	\x07\b	\b			
	
\v	\v\f	\f\x1B
 
\r!\x07&
\f)\v\x07+
\f.\v4
7
\r8\x07\x07\x07\x07\x07\x07\x07\x07D
\x07\f\x07\x07G\v\x07\x07\x07J
\x07\x07\x07\b\b\b\b\b\b\x07\bT
\b\f\b\bW\v\b\b\bZ
\b\b\b			


c

\v\v\f\f\fi
\f\f\r\b
\f\vm3\b6
:\f=M]\`df\x1B\x07\f\x1B\x1B\x07 \b !!!"",#'$&\b%$&)'%'((+)'*#+.,*,--.,/4\f\x0704\b14
24	3/3031324\x0757	657886899	:;\x07;<
<\v=>\x07>?\v?@\x07\x07@E\fAB\x07BD\fCADGECEFFIGEHJ\x07IHIJJKKL\x07\bL\rMN\x07NO\vOP\x07\x07PU\fQR\x07RT\fSQTWUSUVVYWUXZ\x07YXYZZ[[\\\x07\b\\]^\x07^_
_\`b\x07ac\x07
babccde\x07efh\x07gi\x07
hghii!',38EIUYbh`;var lt=class extends _.ParserRuleContext{query(){return this.getRuleContext(0,$)}EOF(){return this.getToken(i.EOF,0)}EOF_STATEMENT(){return this.tryGetToken(i.EOF_STATEMENT,0)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_input}enterRule(t){t.enterInput&&t.enterInput(this)}exitRule(t){t.exitInput&&t.exitInput(this)}accept(t){return t.visitInput?t.visitInput(this):t.visitChildren(this)}},$=class extends _.ParserRuleContext{ignored(t){return t===void 0?this.getRuleContexts(P):this.getRuleContext(t,P)}param(t){return t===void 0?this.getRuleContexts(S):this.getRuleContext(t,S)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_query}enterRule(t){t.enterQuery&&t.enterQuery(this)}exitRule(t){t.exitQuery&&t.exitQuery(this)}accept(t){return t.visitQuery?t.visitQuery(this):t.visitChildren(this)}},S=class extends _.ParserRuleContext{pickParam(){return this.tryGetRuleContext(0,V)}arrayPickParam(){return this.tryGetRuleContext(0,j)}scalarParam(){return this.tryGetRuleContext(0,Y)}arrayParam(){return this.tryGetRuleContext(0,z)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_param}enterRule(t){t.enterParam&&t.enterParam(this)}exitRule(t){t.exitParam&&t.exitParam(this)}accept(t){return t.visitParam?t.visitParam(this):t.visitChildren(this)}},P=class extends _.ParserRuleContext{ID(t){return t===void 0?this.getTokens(i.ID):this.getToken(i.ID,t)}WORD(t){return t===void 0?this.getTokens(i.WORD):this.getToken(i.WORD,t)}STRING(t){return t===void 0?this.getTokens(i.STRING):this.getToken(i.STRING,t)}COMMA(t){return t===void 0?this.getTokens(i.COMMA):this.getToken(i.COMMA,t)}OB(t){return t===void 0?this.getTokens(i.OB):this.getToken(i.OB,t)}CB(t){return t===void 0?this.getTokens(i.CB):this.getToken(i.CB,t)}SPECIAL(t){return t===void 0?this.getTokens(i.SPECIAL):this.getToken(i.SPECIAL,t)}REQUIRED_MARK(t){return t===void 0?this.getTokens(i.REQUIRED_MARK):this.getToken(i.REQUIRED_MARK,t)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_ignored}enterRule(t){t.enterIgnored&&t.enterIgnored(this)}exitRule(t){t.exitIgnored&&t.exitIgnored(this)}accept(t){return t.visitIgnored?t.visitIgnored(this):t.visitChildren(this)}},Y=class extends _.ParserRuleContext{SINGULAR_PARAM_MARK(){return this.getToken(i.SINGULAR_PARAM_MARK,0)}scalarParamName(){return this.getRuleContext(0,k)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_scalarParam}enterRule(t){t.enterScalarParam&&t.enterScalarParam(this)}exitRule(t){t.exitScalarParam&&t.exitScalarParam(this)}accept(t){return t.visitScalarParam?t.visitScalarParam(this):t.visitChildren(this)}},V=class extends _.ParserRuleContext{SINGULAR_PARAM_MARK(){return this.getToken(i.SINGULAR_PARAM_MARK,0)}paramName(){return this.getRuleContext(0,D)}OB(){return this.getToken(i.OB,0)}pickKey(t){return t===void 0?this.getRuleContexts(g):this.getRuleContext(t,g)}CB(){return this.getToken(i.CB,0)}COMMA(t){return t===void 0?this.getTokens(i.COMMA):this.getToken(i.COMMA,t)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_pickParam}enterRule(t){t.enterPickParam&&t.enterPickParam(this)}exitRule(t){t.exitPickParam&&t.exitPickParam(this)}accept(t){return t.visitPickParam?t.visitPickParam(this):t.visitChildren(this)}},j=class extends _.ParserRuleContext{PLURAL_PARAM_MARK(){return this.getToken(i.PLURAL_PARAM_MARK,0)}paramName(){return this.getRuleContext(0,D)}OB(){return this.getToken(i.OB,0)}pickKey(t){return t===void 0?this.getRuleContexts(g):this.getRuleContext(t,g)}CB(){return this.getToken(i.CB,0)}COMMA(t){return t===void 0?this.getTokens(i.COMMA):this.getToken(i.COMMA,t)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_arrayPickParam}enterRule(t){t.enterArrayPickParam&&t.enterArrayPickParam(this)}exitRule(t){t.exitArrayPickParam&&t.exitArrayPickParam(this)}accept(t){return t.visitArrayPickParam?t.visitArrayPickParam(this):t.visitChildren(this)}},z=class extends _.ParserRuleContext{PLURAL_PARAM_MARK(){return this.getToken(i.PLURAL_PARAM_MARK,0)}scalarParamName(){return this.getRuleContext(0,k)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_arrayParam}enterRule(t){t.enterArrayParam&&t.enterArrayParam(this)}exitRule(t){t.exitArrayParam&&t.exitArrayParam(this)}accept(t){return t.visitArrayParam?t.visitArrayParam(this):t.visitChildren(this)}},k=class extends _.ParserRuleContext{ID(){return this.getToken(i.ID,0)}REQUIRED_MARK(){return this.tryGetToken(i.REQUIRED_MARK,0)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_scalarParamName}enterRule(t){t.enterScalarParamName&&t.enterScalarParamName(this)}exitRule(t){t.exitScalarParamName&&t.exitScalarParamName(this)}accept(t){return t.visitScalarParamName?t.visitScalarParamName(this):t.visitChildren(this)}},D=class extends _.ParserRuleContext{ID(){return this.getToken(i.ID,0)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_paramName}enterRule(t){t.enterParamName&&t.enterParamName(this)}exitRule(t){t.exitParamName&&t.exitParamName(this)}accept(t){return t.visitParamName?t.visitParamName(this):t.visitChildren(this)}},g=class extends _.ParserRuleContext{ID(){return this.getToken(i.ID,0)}REQUIRED_MARK(){return this.tryGetToken(i.REQUIRED_MARK,0)}constructor(t,e){super(t,e)}get ruleIndex(){return i.RULE_pickKey}enterRule(t){t.enterPickKey&&t.enterPickKey(this)}exitRule(t){t.exitPickKey&&t.exitPickKey(this)}accept(t){return t.visitPickKey?t.visitPickKey(this):t.visitChildren(this)}};var se=C(require("chalk"),1),mt;(function(n){n[n.ParamNeverUsed=0]="ParamNeverUsed"})(mt||(mt={}));var dt;(function(n){n[n.ParseError=0]="ParseError"})(dt||(dt={}));var J;(function(n){n[n.Info=0]="Info",n[n.Warning=1]="Warning",n[n.Error=2]="Error"})(J||(J={}));var v=class{constructor(){this.parseEvents=[]}logEvent(t){this.parseEvents.push(t)}syntaxError(t,e,r,s,u,m){this.logEvent({type:J.Error,critical:!0,message:{type:dt.ParseError,text:`Parse error: ${u}`},location:{a:e==null?void 0:e.startIndex,b:e==null?void 0:e.stopIndex,line:r,col:s}})}};var Lt=require("antlr4ts/misc/index.js"),T;(function(n){n.Scalar="scalar",n.Object="object",n.ScalarArray="scalar_array",n.ObjectArray="object_array"})(T||(T={}));function ae(n){if(!n)throw new Error("Assertion Failed")}var pt=class{constructor(t,e){this.query={},this.currentParam={},this.currentSelection={},this.query.name=t,this.logger=e}enterQuery(t){let{inputStream:e}=t.start,r=t.stop.stopIndex,s=new Lt.Interval(0,r),u=e.getText(s);this.query={name:this.query.name,text:u,params:[]}}enterParamName(t){this.currentParam={name:t.text,selection:void 0}}enterScalarParamName(t){let e=!!t.REQUIRED_MARK(),r=t.ID().text;this.currentParam={name:r,required:e}}exitParam(t){let e={a:t.start.startIndex,b:t.stop.stopIndex,line:t.start.line,col:t.start.charPositionInLine};this.currentParam.location=e,this.currentParam.selection=this.currentSelection,this.query.params.push(this.currentParam),this.currentSelection={},this.currentParam={}}enterScalarParam(){this.currentSelection={type:T.Scalar}}enterPickParam(){this.currentSelection={type:T.Object,keys:[]}}enterArrayPickParam(){this.currentSelection={type:T.ObjectArray,keys:[]}}enterArrayParam(){this.currentSelection={type:T.ScalarArray}}enterPickKey(t){ae("keys"in this.currentSelection);let e=!!t.REQUIRED_MARK(),r=t.ID().text;this.currentSelection.keys.push({name:r,required:e})}};function he(n,t="query"){let e=new v,r=Z.CharStreams.fromString(n),s=new l(r);s.removeErrorListeners(),s.addErrorListener(e);let u=new Z.CommonTokenStream(s),m=new i(u);m.removeErrorListeners(),m.addErrorListener(e);let c=m.input(),a=new pt(t,e);return bt.ParseTreeWalker.DEFAULT.walk(a,c),{query:a.query,events:e.parseEvents}}var Rt=he;var zt=require("antlr4ts"),oe=require("antlr4ts/tree/ParseTreeWalker.js");var Bt=require("antlr4ts/atn/ATNDeserializer.js"),Ft=require("antlr4ts/Lexer.js"),wt=require("antlr4ts/atn/LexerATNSimulator.js"),Ht=require("antlr4ts/VocabularyImpl.js"),Kt=C(require("antlr4ts/misc/Utils.js"),1),h=class extends Ft.Lexer{get vocabulary(){return h.VOCABULARY}constructor(t){super(t),this._interp=new wt.LexerATNSimulator(h._ATN,this)}get grammarFileName(){return"SQLLexer.g4"}get ruleNames(){return h.ruleNames}get serializedATN(){return h._serializedATN}get channelNames(){return h.channelNames}get modeNames(){return h.modeNames}static get _ATN(){return h.__ATN||(h.__ATN=new Bt.ATNDeserializer().deserialize(Kt.toCharArray(h._serializedATN))),h.__ATN}};h.ID=1;h.LINE_COMMENT=2;h.OPEN_COMMENT=3;h.S_REQUIRED_MARK=4;h.WORD=5;h.EOF_STATEMENT=6;h.WSL=7;h.STRING=8;h.PARAM_MARK=9;h.WS=10;h.TRANSFORM_ARROW=11;h.SPREAD=12;h.NAME_TAG=13;h.TYPE_TAG=14;h.OB=15;h.CB=16;h.COMMA=17;h.C_REQUIRED_MARK=18;h.ANY=19;h.CLOSE_COMMENT=20;h.CAST=21;h.COMMENT=1;h.channelNames=["DEFAULT_TOKEN_CHANNEL","HIDDEN"];h.modeNames=["DEFAULT_MODE","COMMENT"];h.ruleNames=["QUOT","ID","LINE_COMMENT","OPEN_COMMENT","SID","S_REQUIRED_MARK","WORD","SPECIAL","EOF_STATEMENT","WSL","STRING","PARAM_MARK","CAST","CID","WS","TRANSFORM_ARROW","SPREAD","NAME_TAG","TYPE_TAG","OB","CB","COMMA","C_REQUIRED_MARK","ANY","CLOSE_COMMENT"];h._LITERAL_NAMES=[void 0,void 0,void 0,"'/*'",void 0,void 0,"';'",void 0,void 0,"':'",void 0,"'->'","'...'","'@name'","'@param'","'('","')'","','",void 0,void 0,"'*/'","'::'"];h._SYMBOLIC_NAMES=[void 0,"ID","LINE_COMMENT","OPEN_COMMENT","S_REQUIRED_MARK","WORD","EOF_STATEMENT","WSL","STRING","PARAM_MARK","WS","TRANSFORM_ARROW","SPREAD","NAME_TAG","TYPE_TAG","OB","CB","COMMA","C_REQUIRED_MARK","ANY","CLOSE_COMMENT","CAST"];h.VOCABULARY=new Ht.VocabularyImpl(h._LITERAL_NAMES,h._SYMBOLIC_NAMES,[]);h._serializedATN=`\uC91D\uCABA\u058D\uAFBA\u4F53\u0607\uEA8B\uC241\xB1\b\b					\x07	\x07\b	\b			
	
\v	\v\f	\f\r	\r													\x07;
\f>\v\x07D
\fG\vJ
\x07\x07\b\bZ
\b\r\b\b[		_
	\r		\`		

\v\vh
\v\r\v\vi\v\v\f\f\f\x07\fq
\f\f\f\ft\v\f\f\f\fx
\f\r\r\x86
\r\x87\xA9
\r\xAAr\xAA\x1B\b
\f\x07\b	
\v \f"\r$&(*,.024\bC\\aac|2;C\\aac|\f\f	$(*1>B]]_\`bb}\x80\v\f""^^\xB7\b
\f "$&(*,.02468\b?
M\fRVY^dgmy{\x80 \x85"\x8B$\x8E&\x92(\x98*\x9F,\xA1.\xA30\xA52\xA84\xAC67\x07)78<	9;	:9;><:<==\x07><?@\x07/@A\x07/AEBD
CBDGECEFFIGEHJ\x07IHIJJKKL\x07\fL	MN\x071NO\x07,OPPQ\bQ\vRSSTTU\bU\rVW\x07#WXZ	YXZ[[Y[\\\\]_	^]_\`\`^\`aabbc\b	cde\x07=efh	gfhiigijjkkl\b\vlmwnxoq\vpoqtrsrpsutruv
\x07vxwnwrxyz\x07<z\x1B{|\x07<|}\x07<}~~\x7F\b\x7F\x80\x81\x81\x82\x82\x83\b\x83\x84\x86	\x85\x84\x86\x87\x87\x85\x87\x88\x88\x89\x89\x8A\b\x8A!\x8B\x8C\x07/\x8C\x8D\x07@\x8D#\x8E\x8F\x070\x8F\x90\x070\x90\x91\x070\x91%\x92\x93\x07B\x93\x94\x07p\x94\x95\x07c\x95\x96\x07o\x96\x97\x07g\x97'\x98\x99\x07B\x99\x9A\x07r\x9A\x9B\x07c\x9B\x9C\x07t\x9C\x9D\x07c\x9D\x9E\x07o\x9E)\x9F\xA0\x07*\xA0+\xA1\xA2\x07+\xA2-\xA3\xA4\x07.\xA4/\xA5\xA6\x07#\xA61\xA7\xA9\v\xA8\xA7\xA9\xAA\xAA\xAB\xAA\xA8\xAB3\xAC\xAD\x07,\xAD\xAE\x071\xAE\xAF\xAF\xB0\b\xB05<EI[\`irw\x87\xAA\x07		\x07\b`;var ft=require("antlr4ts/atn/ATN.js"),Gt=require("antlr4ts/atn/ATNDeserializer.js"),qt=require("antlr4ts/FailedPredicateException.js"),Wt=require("antlr4ts/NoViableAltException.js"),$t=require("antlr4ts/Parser.js"),f=require("antlr4ts/ParserRuleContext.js"),Yt=require("antlr4ts/atn/ParserATNSimulator.js"),R=require("antlr4ts/RecognitionException.js"),At=require("antlr4ts/Token.js"),Vt=require("antlr4ts/VocabularyImpl.js"),jt=C(require("antlr4ts/misc/Utils.js"),1),x=class extends $t.Parser{get vocabulary(){return x.VOCABULARY}get grammarFileName(){return"SQLParser.g4"}get ruleNames(){return x.ruleNames}get serializedATN(){return x._serializedATN}createFailedPredicateException(t,e){return new qt.FailedPredicateException(this,t,e)}constructor(t){super(t),this._interp=new Yt.ParserATNSimulator(x._ATN,this)}input(){let t=new Et(this._ctx,this.state);this.enterRule(t,0,x.RULE_input);let e;try{let r;this.enterOuterAlt(t,1);{this.state=45,this._errHandler.sync(this),e=this._input.LA(1);do{{for(this.state=41,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,0,this._ctx);r!==2&&r!==ft.ATN.INVALID_ALT_NUMBER;)r===1&&(this.state=38,this.ignoredComment()),this.state=43,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,0,this._ctx);this.state=44,this.query()}this.state=47,this._errHandler.sync(this),e=this._input.LA(1)}while(e===x.OPEN_COMMENT);this.state=49,this.match(x.EOF)}}catch(r){if(r instanceof R.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}query(){let t=new U(this._ctx,this.state);this.enterRule(t,2,x.RULE_query);try{this.enterOuterAlt(t,1),this.state=51,this.queryDef(),this.state=52,this.statement()}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}queryDef(){let t=new X(this._ctx,this.state);this.enterRule(t,4,x.RULE_queryDef);let e;try{this.enterOuterAlt(t,1);{for(this.state=54,this.match(x.OPEN_COMMENT),this.state=55,this.nameTag(),this.state=59,this._errHandler.sync(this),e=this._input.LA(1);e===x.TYPE_TAG;)this.state=56,this.paramTag(),this.state=61,this._errHandler.sync(this),e=this._input.LA(1);this.state=62,this.match(x.CLOSE_COMMENT)}}catch(r){if(r instanceof R.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}ignoredComment(){let t=new I(this._ctx,this.state);this.enterRule(t,6,x.RULE_ignoredComment);let e;try{this.enterOuterAlt(t,1);{for(this.state=64,this.match(x.OPEN_COMMENT),this.state=68,this._errHandler.sync(this),e=this._input.LA(1);!(e&-32)&&1<<e&(1<<x.ID|1<<x.LINE_COMMENT|1<<x.OPEN_COMMENT|1<<x.S_REQUIRED_MARK|1<<x.WORD|1<<x.EOF_STATEMENT|1<<x.WSL|1<<x.STRING|1<<x.PARAM_MARK|1<<x.WS|1<<x.TRANSFORM_ARROW|1<<x.SPREAD|1<<x.NAME_TAG|1<<x.TYPE_TAG|1<<x.OB|1<<x.CB|1<<x.COMMA|1<<x.C_REQUIRED_MARK|1<<x.ANY|1<<x.CAST);)this.state=65,e=this._input.LA(1),e<=0||e===x.CLOSE_COMMENT?this._errHandler.recoverInline(this):(this._input.LA(1)===At.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()),this.state=70,this._errHandler.sync(this),e=this._input.LA(1);this.state=71,this.match(x.CLOSE_COMMENT)}}catch(r){if(r instanceof R.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}statement(){let t=new Q(this._ctx,this.state);this.enterRule(t,8,x.RULE_statement);try{this.enterOuterAlt(t,1),this.state=73,this.statementBody(),this.state=74,this.match(x.EOF_STATEMENT)}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}statementBody(){let t=new tt(this._ctx,this.state);this.enterRule(t,10,x.RULE_statementBody);let e;try{for(this.enterOuterAlt(t,1),this.state=82,this._errHandler.sync(this),e=this._input.LA(1);!(e&-32)&&1<<e&(1<<x.ID|1<<x.LINE_COMMENT|1<<x.OPEN_COMMENT|1<<x.S_REQUIRED_MARK|1<<x.WORD|1<<x.STRING|1<<x.PARAM_MARK);){switch(this.state=80,this._errHandler.sync(this),this._input.LA(1)){case x.LINE_COMMENT:this.state=76,this.match(x.LINE_COMMENT);break;case x.OPEN_COMMENT:this.state=77,this.ignoredComment();break;case x.PARAM_MARK:this.state=78,this.param();break;case x.ID:case x.S_REQUIRED_MARK:case x.WORD:case x.STRING:this.state=79,this.word();break;default:throw new Wt.NoViableAltException(this)}this.state=84,this._errHandler.sync(this),e=this._input.LA(1)}}catch(r){if(r instanceof R.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}word(){let t=new b(this._ctx,this.state);this.enterRule(t,12,x.RULE_word);let e;try{this.enterOuterAlt(t,1),this.state=85,e=this._input.LA(1),!(e&-32)&&1<<e&(1<<x.ID|1<<x.S_REQUIRED_MARK|1<<x.WORD|1<<x.STRING)?(this._input.LA(1)===At.Token.EOF&&(this.matchedEOF=!0),this._errHandler.reportMatch(this),this.consume()):this._errHandler.recoverInline(this)}catch(r){if(r instanceof R.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}param(){let t=new L(this._ctx,this.state);this.enterRule(t,14,x.RULE_param);try{this.enterOuterAlt(t,1),this.state=87,this.match(x.PARAM_MARK),this.state=88,this.paramId()}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}paramId(){let t=new et(this._ctx,this.state);this.enterRule(t,16,x.RULE_paramId);try{switch(this.enterOuterAlt(t,1),this.state=90,this.match(x.ID),this.state=92,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,6,this._ctx)){case 1:this.state=91,this.match(x.S_REQUIRED_MARK);break}}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}nameTag(){let t=new xt(this._ctx,this.state);this.enterRule(t,18,x.RULE_nameTag);try{this.enterOuterAlt(t,1),this.state=94,this.match(x.NAME_TAG),this.state=95,this.queryName()}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}paramTag(){let t=new B(this._ctx,this.state);this.enterRule(t,20,x.RULE_paramTag);try{this.enterOuterAlt(t,1),this.state=97,this.match(x.TYPE_TAG),this.state=98,this.paramName(),this.state=99,this.paramTransform()}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}paramTransform(){let t=new rt(this._ctx,this.state);this.enterRule(t,22,x.RULE_paramTransform);try{this.enterOuterAlt(t,1),this.state=101,this.match(x.TRANSFORM_ARROW),this.state=102,this.transformRule()}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}transformRule(){let t=new it(this._ctx,this.state);this.enterRule(t,24,x.RULE_transformRule);try{switch(this.state=107,this._errHandler.sync(this),this.interpreter.adaptivePredict(this._input,7,this._ctx)){case 1:this.enterOuterAlt(t,1),this.state=104,this.spreadTransform();break;case 2:this.enterOuterAlt(t,2),this.state=105,this.pickTransform();break;case 3:this.enterOuterAlt(t,3),this.state=106,this.spreadPickTransform();break}}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}spreadTransform(){let t=new nt(this._ctx,this.state);this.enterRule(t,26,x.RULE_spreadTransform);try{this.enterOuterAlt(t,1),this.state=109,this.match(x.OB),this.state=110,this.match(x.SPREAD),this.state=111,this.match(x.CB)}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}pickTransform(){let t=new F(this._ctx,this.state);this.enterRule(t,28,x.RULE_pickTransform);let e;try{let r;this.enterOuterAlt(t,1);{for(this.state=113,this.match(x.OB),this.state=114,this.key(),this.state=119,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,8,this._ctx);r!==2&&r!==ft.ATN.INVALID_ALT_NUMBER;)r===1&&(this.state=115,this.match(x.COMMA),this.state=116,this.key()),this.state=121,this._errHandler.sync(this),r=this.interpreter.adaptivePredict(this._input,8,this._ctx);this.state=123,this._errHandler.sync(this),e=this._input.LA(1),e===x.COMMA&&(this.state=122,this.match(x.COMMA)),this.state=125,this.match(x.CB)}}catch(r){if(r instanceof R.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}spreadPickTransform(){let t=new st(this._ctx,this.state);this.enterRule(t,30,x.RULE_spreadPickTransform);try{this.enterOuterAlt(t,1),this.state=127,this.match(x.OB),this.state=128,this.pickTransform(),this.state=129,this.match(x.SPREAD),this.state=130,this.match(x.CB)}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}key(){let t=new w(this._ctx,this.state);this.enterRule(t,32,x.RULE_key);let e;try{this.enterOuterAlt(t,1),this.state=132,this.match(x.ID),this.state=134,this._errHandler.sync(this),e=this._input.LA(1),e===x.C_REQUIRED_MARK&&(this.state=133,this.match(x.C_REQUIRED_MARK))}catch(r){if(r instanceof R.RecognitionException)t.exception=r,this._errHandler.reportError(this,r),this._errHandler.recover(this,r);else throw r}finally{this.exitRule()}return t}queryName(){let t=new at(this._ctx,this.state);this.enterRule(t,34,x.RULE_queryName);try{this.enterOuterAlt(t,1),this.state=136,this.match(x.ID)}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}paramName(){let t=new ht(this._ctx,this.state);this.enterRule(t,36,x.RULE_paramName);try{this.enterOuterAlt(t,1),this.state=138,this.match(x.ID)}catch(e){if(e instanceof R.RecognitionException)t.exception=e,this._errHandler.reportError(this,e),this._errHandler.recover(this,e);else throw e}finally{this.exitRule()}return t}static get _ATN(){return x.__ATN||(x.__ATN=new Gt.ATNDeserializer().deserialize(jt.toCharArray(x._serializedATN))),x.__ATN}};x.ID=1;x.LINE_COMMENT=2;x.OPEN_COMMENT=3;x.S_REQUIRED_MARK=4;x.WORD=5;x.EOF_STATEMENT=6;x.WSL=7;x.STRING=8;x.PARAM_MARK=9;x.WS=10;x.TRANSFORM_ARROW=11;x.SPREAD=12;x.NAME_TAG=13;x.TYPE_TAG=14;x.OB=15;x.CB=16;x.COMMA=17;x.C_REQUIRED_MARK=18;x.ANY=19;x.CLOSE_COMMENT=20;x.CAST=21;x.RULE_input=0;x.RULE_query=1;x.RULE_queryDef=2;x.RULE_ignoredComment=3;x.RULE_statement=4;x.RULE_statementBody=5;x.RULE_word=6;x.RULE_param=7;x.RULE_paramId=8;x.RULE_nameTag=9;x.RULE_paramTag=10;x.RULE_paramTransform=11;x.RULE_transformRule=12;x.RULE_spreadTransform=13;x.RULE_pickTransform=14;x.RULE_spreadPickTransform=15;x.RULE_key=16;x.RULE_queryName=17;x.RULE_paramName=18;x.ruleNames=["input","query","queryDef","ignoredComment","statement","statementBody","word","param","paramId","nameTag","paramTag","paramTransform","transformRule","spreadTransform","pickTransform","spreadPickTransform","key","queryName","paramName"];x._LITERAL_NAMES=[void 0,void 0,void 0,"'/*'",void 0,void 0,"';'",void 0,void 0,"':'",void 0,"'->'","'...'","'@name'","'@param'","'('","')'","','",void 0,void 0,"'*/'","'::'"];x._SYMBOLIC_NAMES=[void 0,"ID","LINE_COMMENT","OPEN_COMMENT","S_REQUIRED_MARK","WORD","EOF_STATEMENT","WSL","STRING","PARAM_MARK","WS","TRANSFORM_ARROW","SPREAD","NAME_TAG","TYPE_TAG","OB","CB","COMMA","C_REQUIRED_MARK","ANY","CLOSE_COMMENT","CAST"];x.VOCABULARY=new Vt.VocabularyImpl(x._LITERAL_NAMES,x._SYMBOLIC_NAMES,[]);x._serializedATN=`\uC91D\uCABA\u058D\uAFBA\u4F53\u0607\uEA8B\uC241\x8F					\x07	\x07\b	\b			
	
\v	\v\f	\f\r	\r							\x07*
\f-\v0
\r1\x07<
\f?\v\x07E
\fH\v\x07\x07\x07\x07\x07\x07S
\x07\f\x07\x07V\v\x07\b\b			


_

\v\v\v\f\f\f\f\r\r\rn
\x07x
\f{\v~
\x89
\b
\f "$&\x07

\x89/58\bB
K\fTWY\\\`cgmos \x81"\x86$\x8A&\x8C(*\b)(*-+)+,,.-+.0/+011/122334\x0745667
789\x079=\v:<\f;:<?=;=>>@?=@A\x07A\x07BF\x07CE
DCEHFDFGGIHFIJ\x07J	KL\f\x07LM\x07\bM\vNS\x07OS\bPS	QS\bRNRORPRQSVTRTUU\rVTWX	XYZ\x07\vZ[
[\\^\x07]_\x07^]^__\`a\x07ab$bcd\x07de&ef\rfgh\x07\rhiijnknln mjmkmln\x1Bop\x07pq\x07qr\x07rst\x07ty"uv\x07vx"wux{ywyzz}{y|~\x07}|}~~\x7F\x7F\x80\x07\x80\x81\x82\x07\x82\x83\x83\x84\x07\x84\x85\x07\x85!\x86\x88\x07\x87\x89\x07\x88\x87\x88\x89\x89#\x8A\x8B\x07\x8B%\x8C\x8D\x07\x8D'\r+1=FRT^my}\x88`;var Et=class extends f.ParserRuleContext{EOF(){return this.getToken(x.EOF,0)}query(t){return t===void 0?this.getRuleContexts(U):this.getRuleContext(t,U)}ignoredComment(t){return t===void 0?this.getRuleContexts(I):this.getRuleContext(t,I)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_input}enterRule(t){t.enterInput&&t.enterInput(this)}exitRule(t){t.exitInput&&t.exitInput(this)}accept(t){return t.visitInput?t.visitInput(this):t.visitChildren(this)}},U=class extends f.ParserRuleContext{queryDef(){return this.getRuleContext(0,X)}statement(){return this.getRuleContext(0,Q)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_query}enterRule(t){t.enterQuery&&t.enterQuery(this)}exitRule(t){t.exitQuery&&t.exitQuery(this)}accept(t){return t.visitQuery?t.visitQuery(this):t.visitChildren(this)}},X=class extends f.ParserRuleContext{OPEN_COMMENT(){return this.getToken(x.OPEN_COMMENT,0)}nameTag(){return this.getRuleContext(0,xt)}CLOSE_COMMENT(){return this.getToken(x.CLOSE_COMMENT,0)}paramTag(t){return t===void 0?this.getRuleContexts(B):this.getRuleContext(t,B)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_queryDef}enterRule(t){t.enterQueryDef&&t.enterQueryDef(this)}exitRule(t){t.exitQueryDef&&t.exitQueryDef(this)}accept(t){return t.visitQueryDef?t.visitQueryDef(this):t.visitChildren(this)}},I=class extends f.ParserRuleContext{OPEN_COMMENT(){return this.getToken(x.OPEN_COMMENT,0)}CLOSE_COMMENT(t){return t===void 0?this.getTokens(x.CLOSE_COMMENT):this.getToken(x.CLOSE_COMMENT,t)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_ignoredComment}enterRule(t){t.enterIgnoredComment&&t.enterIgnoredComment(this)}exitRule(t){t.exitIgnoredComment&&t.exitIgnoredComment(this)}accept(t){return t.visitIgnoredComment?t.visitIgnoredComment(this):t.visitChildren(this)}},Q=class extends f.ParserRuleContext{statementBody(){return this.getRuleContext(0,tt)}EOF_STATEMENT(){return this.getToken(x.EOF_STATEMENT,0)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_statement}enterRule(t){t.enterStatement&&t.enterStatement(this)}exitRule(t){t.exitStatement&&t.exitStatement(this)}accept(t){return t.visitStatement?t.visitStatement(this):t.visitChildren(this)}},tt=class extends f.ParserRuleContext{LINE_COMMENT(t){return t===void 0?this.getTokens(x.LINE_COMMENT):this.getToken(x.LINE_COMMENT,t)}ignoredComment(t){return t===void 0?this.getRuleContexts(I):this.getRuleContext(t,I)}param(t){return t===void 0?this.getRuleContexts(L):this.getRuleContext(t,L)}word(t){return t===void 0?this.getRuleContexts(b):this.getRuleContext(t,b)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_statementBody}enterRule(t){t.enterStatementBody&&t.enterStatementBody(this)}exitRule(t){t.exitStatementBody&&t.exitStatementBody(this)}accept(t){return t.visitStatementBody?t.visitStatementBody(this):t.visitChildren(this)}},b=class extends f.ParserRuleContext{WORD(){return this.tryGetToken(x.WORD,0)}ID(){return this.tryGetToken(x.ID,0)}STRING(){return this.tryGetToken(x.STRING,0)}S_REQUIRED_MARK(){return this.tryGetToken(x.S_REQUIRED_MARK,0)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_word}enterRule(t){t.enterWord&&t.enterWord(this)}exitRule(t){t.exitWord&&t.exitWord(this)}accept(t){return t.visitWord?t.visitWord(this):t.visitChildren(this)}},L=class extends f.ParserRuleContext{PARAM_MARK(){return this.getToken(x.PARAM_MARK,0)}paramId(){return this.getRuleContext(0,et)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_param}enterRule(t){t.enterParam&&t.enterParam(this)}exitRule(t){t.exitParam&&t.exitParam(this)}accept(t){return t.visitParam?t.visitParam(this):t.visitChildren(this)}},et=class extends f.ParserRuleContext{ID(){return this.getToken(x.ID,0)}S_REQUIRED_MARK(){return this.tryGetToken(x.S_REQUIRED_MARK,0)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_paramId}enterRule(t){t.enterParamId&&t.enterParamId(this)}exitRule(t){t.exitParamId&&t.exitParamId(this)}accept(t){return t.visitParamId?t.visitParamId(this):t.visitChildren(this)}},xt=class extends f.ParserRuleContext{NAME_TAG(){return this.getToken(x.NAME_TAG,0)}queryName(){return this.getRuleContext(0,at)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_nameTag}enterRule(t){t.enterNameTag&&t.enterNameTag(this)}exitRule(t){t.exitNameTag&&t.exitNameTag(this)}accept(t){return t.visitNameTag?t.visitNameTag(this):t.visitChildren(this)}},B=class extends f.ParserRuleContext{TYPE_TAG(){return this.getToken(x.TYPE_TAG,0)}paramName(){return this.getRuleContext(0,ht)}paramTransform(){return this.getRuleContext(0,rt)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_paramTag}enterRule(t){t.enterParamTag&&t.enterParamTag(this)}exitRule(t){t.exitParamTag&&t.exitParamTag(this)}accept(t){return t.visitParamTag?t.visitParamTag(this):t.visitChildren(this)}},rt=class extends f.ParserRuleContext{TRANSFORM_ARROW(){return this.getToken(x.TRANSFORM_ARROW,0)}transformRule(){return this.getRuleContext(0,it)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_paramTransform}enterRule(t){t.enterParamTransform&&t.enterParamTransform(this)}exitRule(t){t.exitParamTransform&&t.exitParamTransform(this)}accept(t){return t.visitParamTransform?t.visitParamTransform(this):t.visitChildren(this)}},it=class extends f.ParserRuleContext{spreadTransform(){return this.tryGetRuleContext(0,nt)}pickTransform(){return this.tryGetRuleContext(0,F)}spreadPickTransform(){return this.tryGetRuleContext(0,st)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_transformRule}enterRule(t){t.enterTransformRule&&t.enterTransformRule(this)}exitRule(t){t.exitTransformRule&&t.exitTransformRule(this)}accept(t){return t.visitTransformRule?t.visitTransformRule(this):t.visitChildren(this)}},nt=class extends f.ParserRuleContext{OB(){return this.getToken(x.OB,0)}SPREAD(){return this.getToken(x.SPREAD,0)}CB(){return this.getToken(x.CB,0)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_spreadTransform}enterRule(t){t.enterSpreadTransform&&t.enterSpreadTransform(this)}exitRule(t){t.exitSpreadTransform&&t.exitSpreadTransform(this)}accept(t){return t.visitSpreadTransform?t.visitSpreadTransform(this):t.visitChildren(this)}},F=class extends f.ParserRuleContext{OB(){return this.getToken(x.OB,0)}key(t){return t===void 0?this.getRuleContexts(w):this.getRuleContext(t,w)}CB(){return this.getToken(x.CB,0)}COMMA(t){return t===void 0?this.getTokens(x.COMMA):this.getToken(x.COMMA,t)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_pickTransform}enterRule(t){t.enterPickTransform&&t.enterPickTransform(this)}exitRule(t){t.exitPickTransform&&t.exitPickTransform(this)}accept(t){return t.visitPickTransform?t.visitPickTransform(this):t.visitChildren(this)}},st=class extends f.ParserRuleContext{OB(){return this.getToken(x.OB,0)}pickTransform(){return this.getRuleContext(0,F)}SPREAD(){return this.getToken(x.SPREAD,0)}CB(){return this.getToken(x.CB,0)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_spreadPickTransform}enterRule(t){t.enterSpreadPickTransform&&t.enterSpreadPickTransform(this)}exitRule(t){t.exitSpreadPickTransform&&t.exitSpreadPickTransform(this)}accept(t){return t.visitSpreadPickTransform?t.visitSpreadPickTransform(this):t.visitChildren(this)}},w=class extends f.ParserRuleContext{ID(){return this.getToken(x.ID,0)}C_REQUIRED_MARK(){return this.tryGetToken(x.C_REQUIRED_MARK,0)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_key}enterRule(t){t.enterKey&&t.enterKey(this)}exitRule(t){t.exitKey&&t.exitKey(this)}accept(t){return t.visitKey?t.visitKey(this):t.visitChildren(this)}},at=class extends f.ParserRuleContext{ID(){return this.getToken(x.ID,0)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_queryName}enterRule(t){t.enterQueryName&&t.enterQueryName(this)}exitRule(t){t.exitQueryName&&t.exitQueryName(this)}accept(t){return t.visitQueryName?t.visitQueryName(this):t.visitChildren(this)}},ht=class extends f.ParserRuleContext{ID(){return this.getToken(x.ID,0)}constructor(t,e){super(t,e)}get ruleIndex(){return x.RULE_paramName}enterRule(t){t.enterParamName&&t.enterParamName(this)}exitRule(t){t.exitParamName&&t.exitParamName(this)}accept(t){return t.visitParamName?t.visitParamName(this):t.visitChildren(this)}};var ue=require("antlr4ts/misc/index.js"),y;(function(n){n.Scalar="scalar",n.PickTuple="pick_tuple",n.ArraySpread="array_spread",n.PickArraySpread="pick_array_spread"})(y||(y={}));function H(n){if(!n)throw new Error("Assertion Failed")}function le({name:n,required:t},e,r,s){let u=e,m=[],c,a=r;if(a)c=`$${a.assignedIndex}`;else{let A=++u;if(c=`$${A}`,a={assignedIndex:A,type:0,name:n,required:t},s){let o=s[n];m.push(o)}}return{bindings:m,replacement:c,nextIndex:u,config:a}}function me({name:n,required:t},e,r,s){let u=e,m=[],c=r,a=[];c?a=c.assignedIndex:(s?a=s[n].map(d=>(m.push(d),++u)):a=[++u],c={assignedIndex:a,type:1,name:n,required:t});let A="("+a.map(o=>`$${o}`).join(", ")+")";return{bindings:m,replacement:A,nextIndex:u,config:c}}function de(n,t,e,r,s){let u=e,m=[],c=r||{name:n,type:2,dict:{}},A="("+t.map(({name:o,required:d})=>{if(o in c.dict)return c.dict[o].required=c.dict[o].required||d,`$${c.dict[o].assignedIndex}`;let p=++u;if(c.dict[o]={assignedIndex:p,name:o,required:d,type:0},s){let N=s[n][o];m.push(N)}return`$${p}`}).join(", ")+")";return{bindings:m,replacement:A,nextIndex:u,config:c}}function pe(n,t,e,r,s){let u=e,m=[],c=r||{name:n,type:3,dict:{}},a;if(s){let A=s[n];A.length>0?a=A.map(o=>t.map(({name:d})=>(m.push(o[d]),`$${++u}`)).join(", ")).map(o=>`(${o})`).join(", "):a="()"}else a="("+t.map(({name:o,required:d})=>{if(o in c.dict)return`$${c.dict[o].assignedIndex}`;let p=++u;return c.dict[o]={assignedIndex:p,name:o,required:d,type:0},`$${p}`}).join(", ")+")";return{bindings:m,replacement:a,nextIndex:u,config:c}}var ct=(n,t)=>{let e=[],r={},s=0,u=[];for(let c of n.params){let a,A=[],o,d;if(c.selection.type===T.Scalar){let p=r[c.name];d=le(c,s,p,t)}if(c.selection.type===T.ScalarArray){let p=r[c.name];d=me(c,s,p,t)}if(c.selection.type===T.Object){let p=r[c.name]||{name:c.name,type:2,dict:{}};d=de(c.name,c.selection.keys,s,p,t)}if(c.selection.type===T.ObjectArray){let p=r[c.name]||{name:c.name,type:3,dict:{}};d=pe(c.name,c.selection.keys,s,p,t)}H(d),{config:o,nextIndex:s,replacement:a,bindings:A}=d,r[c.name]=o,e.push(...A),u.push({a:c.location.a,b:c.location.b,sub:a})}let m=q(n.text,u);return{mapping:t?[]:Object.values(r),query:m,bindings:e}};var ot=(n,t)=>{let e=[],r=[],s=n.params.filter(a=>a.name in n.usedParamSet),u=1,m=[];for(let a of s){if(a.transform.type===y.ArraySpread){let o;if(t)o=t[a.name].map(p=>(e.push(p),`$${u++}`)).join(",");else{let d=u++;r.push({name:a.name,type:1,assignedIndex:d,required:a.required}),o=`$${d}`}a.locs.forEach(d=>m.push({...d,sub:`(${o})`}));continue}if(a.transform.type===y.PickTuple){let o={},d=a.transform.keys.map(({name:p,required:N})=>{let M=u++;if(o[p]={name:p,required:N,type:0,assignedIndex:M},t){let Xt=t[a.name][p];e.push(Xt)}return`$${M}`}).join(",");t||r.push({name:a.name,type:2,dict:o}),a.locs.forEach(p=>m.push({...p,sub:`(${d})`}));continue}if(a.transform.type===y.PickArraySpread){let o;if(t)o=t[a.name].map(p=>(H(a.transform.type===y.PickArraySpread),a.transform.keys.map(({name:M})=>{let _t=p[M];return e.push(_t),`$${u++}`}).join(","))).join("),(");else{let d={};o=a.transform.keys.map(({name:p,required:N})=>{let M=u++;return d[p]={name:p,required:N,type:0,assignedIndex:M},`$${M}`}).join(","),r.push({name:a.name,type:3,dict:d})}a.locs.forEach(d=>m.push({...d,sub:`(${o})`}));continue}let A=u++;if(t){let o=t[a.name];e.push(o)}else r.push({name:a.name,type:0,assignedIndex:A,required:a.required});a.locs.forEach(o=>m.push({...o,sub:`$${A}`}))}let c=q(n.statement,m);return{mapping:r,query:c,bindings:e}};function Re(n){let t=n[n.length-1];return t==="!"||t==="?"}function Jt(n){for(let t of n)for(let e in t)if(Re(e)){let r=e.slice(0,-1);t[r]=t[e],delete t[e]}return n}var K=class{constructor(t){this.query=t,this.run=async(e,r)=>{let{query:s,bindings:u}=ct(this.query,e),m=await r.query(s,u);return Jt(m.rows)}}},Zt=n=>{let{query:t}=Rt(n[0]);return new K(t)},ut=class{constructor(t){this.queryIR=t,this.run=async(e,r)=>{let{query:s,bindings:u}=ot(this.queryIR,e),m=await r.query(s,u);return Jt(m.rows)}}};0&&(module.exports={ParameterTransform,PreparedQuery,TaggedQuery,processSQLQueryIR,processTSQueryAST,sql});
//# sourceMappingURL=index.cjs.map
